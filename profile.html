<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>E-Shop | Profile</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body onload="checkLogin(); loadProfile()">
  <header class="navbar">
    <div class="logo">E-Shop</div>
    <nav>
      <a href="index.html">Home</a>
      <a href="orders.html">Orders</a>
      <a href="cart.html">Cart</a>
      <a href="#" onclick="logout()">Logout</a>
    </nav>
  </header>

  <main class="page-content profile-page" style="display:flex; justify-content:center; margin-top:30px;">
    <div style="display:flex; flex-direction:row; justify-content:center; align-items:flex-start; gap:40px; width:90%; max-width:1200px;">

      <!-- Left: Profile block -->
      <div class="profile-card" 
           style="flex:0 0 30%; min-width:250px; max-width:350px; padding:15px; border:1px solid #ccc; border-radius:10px; background:#f9f9f9; height:auto;">
        <h2>My Profile</h2>
        <p><strong>Welcome!</strong></p>
        <p>Username: <span id="profile-username">Loading...</span></p> 
        <p>Email: <span id="profile-email">Loading...</span></p>
        <hr>
        <p>Account Status: <strong>Active</strong></p>
      </div>

      <!-- Right: Delivery address -->
      <div class="address-container" 
           style="flex:1; padding:20px; border:1px solid #ccc; border-radius:10px; background:#fff;">
        <h2>üè† Delivery Address</h2>
        <div id="current-address"></div>

        <form onsubmit="saveAddress(event)" style="margin-top:15px;">
          <h4>Update/Add Address:</h4>
          <input type="text" id="address-line1" placeholder="Flat, House No., Building" required />
          <input type="text" id="address-line2" placeholder="Street, Area, Colony" required />
          <input type="text" id="address-city" placeholder="City" required />
          <input type="text" id="address-pincode" placeholder="Pincode" required />
          <button type="submit">Save Address</button>
        </form>
      </div>
    </div>
  </main>
  
<script>
function loadProfile() {
  const usernameElement = document.getElementById('profile-username');
  const emailElement = document.getElementById('profile-email');
  const addressContainer = document.getElementById('current-address');

  const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));

  if (loggedInUser && loggedInUser.username) {
    usernameElement.textContent = loggedInUser.username;
    emailElement.textContent = loggedInUser.email || "Not provided";
    loadAddress(addressContainer);
  } else {
    usernameElement.textContent = 'Guest';
    emailElement.textContent = 'N/A';
  }
}

function loadAddress(container) {
  const address = JSON.parse(localStorage.getItem('userAddress'));
  if (address) {
    container.innerHTML = `
      <div class="saved-address" style="border:1px dashed #888; padding:8px; border-radius:5px;">
        <p>${address.line1}, ${address.line2}</p>
        <p>${address.city}, Pincode: ${address.pincode}</p>
      </div>
    `;
  } else {
    container.innerHTML = '<p>No saved address. Please add one below.</p>';
  }
}

function saveAddress(event) {
  event.preventDefault();
  const address = {
    line1: document.getElementById('address-line1').value,
    line2: document.getElementById('address-line2').value,
    city: document.getElementById('address-city').value,
    pincode: document.getElementById('address-pincode').value
  };
  localStorage.setItem('userAddress', JSON.stringify(address));
  alert('Address saved successfully!');
  loadAddress(document.getElementById('current-address'));

  // Clear form
  document.getElementById('address-line1').value = '';
  document.getElementById('address-line2').value = '';
  document.getElementById('address-city').value = '';
  document.getElementById('address-pincode').value = '';
}
</script>

<script src="js/auth.js"></script>
</body>
</html>
